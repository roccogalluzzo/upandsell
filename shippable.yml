cache: true
language: ruby
rvm:
  - 2.1.5

services:
    - redis

env:
  global:
    - CI_REPORTS=shippable/testresults COVERAGE_REPORTS=shippable/codecoverage

before_install:
  - gem install capistrano

before_script:
  - mkdir -p shippable/testresults
  - mkdir -p shippable/codecoverage
  - cp config/database.shippable.yml config/database.yml
  - mysql -e 'create database if not exists upsell_test;'
  - RAILS_ENV=test rake db:migrate

script:
  - rake ci:all

after_success:
  - eval `ssh-agent -s`
  - ssh-add
  - cap production deploy

notifications:
     email:
         recipients: rocco@galluzzo.me
      on_success: change
      on_failure: always